<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-8">
    <div>
      <h1 class="text-3xl font-bold text-gray-800">Payment Reports</h1>
      <p class="text-gray-600">Track and analyze payment data</p>
    </div>
    <div class="flex space-x-4">
      <a routerLink="/admin/dashboard" class="text-blue-500 hover:text-blue-700 flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        Back to Dashboard
      </a>
      <button (click)="exportReport()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
        </svg>
        Export Report
      </button>
    </div>
  </div>

  <!-- Loading indicator -->
  <div *ngIf="isLoading" class="flex justify-center py-10">
    <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"></div>
  </div>

  <!-- Main content -->
  <div *ngIf="!isLoading" class="space-y-8">
    <!-- Statistics cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-lg font-semibold text-gray-700">Total Payments</h3>
        <div class="flex items-end mt-2">
          <span class="text-3xl font-bold text-gray-800">{{ formatCurrency(totalPaid + totalDue + totalLate) }}</span>
        </div>
        <p class="text-sm text-gray-500 mt-2">
          {{ paymentCounts.total }} payments recorded
        </p>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-lg font-semibold text-green-700">Completed Payments</h3>
        <div class="flex items-end mt-2">
          <span class="text-3xl font-bold text-green-600">{{ formatCurrency(totalPaid) }}</span>
        </div>
        <p class="text-sm text-gray-500 mt-2">
          {{ paymentCounts.completed }} payments
        </p>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-lg font-semibold text-yellow-700">Pending Payments</h3>
        <div class="flex items-end mt-2">
          <span class="text-3xl font-bold text-yellow-600">{{ formatCurrency(totalDue) }}</span>
        </div>
        <p class="text-sm text-gray-500 mt-2">
          {{ paymentCounts.pending }} payments
        </p>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-lg font-semibold text-red-700">Late Payments</h3>
        <div class="flex items-end mt-2">
          <span class="text-3xl font-bold text-red-600">{{ formatCurrency(totalLate) }}</span>
        </div>
        <p class="text-sm text-gray-500 mt-2">
          {{ paymentCounts.late }} payments
        </p>
      </div>
    </div>

    <!-- Filters -->
    <div class="bg-white rounded-lg shadow-md p-6">
      <h2 class="text-lg font-semibold text-gray-800 mb-4">Filter Reports</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <!-- Search -->
        <div>
          <label for="search" class="block text-sm font-medium text-gray-700 mb-1">Search</label>
          <input
            type="text"
            id="search"
            [(ngModel)]="searchTerm"
            (input)="applyFilters()"
            placeholder="Search by tenant, unit..."
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
          >
        </div>
        
        <!-- Status Filter -->
        <div>
          <label for="status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
          <select
            id="status"
            [(ngModel)]="statusFilter"
            (change)="applyFilters()"
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
          >
            <option value="all">All Statuses</option>
            <option value="Completed">Completed</option>
            <option value="Paid">Paid</option>
            <option value="Pending">Pending</option>
            <option value="Late">Late</option>
            <option value="Failed">Failed</option>
          </select>
        </div>
        
        <!-- Date Range Filter -->
        <div>
          <label for="dateRange" class="block text-sm font-medium text-gray-700 mb-1">Date Range</label>
          <select
            id="dateRange"
            [(ngModel)]="dateRangeFilter"
            (change)="applyFilters()"
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
          >
            <option value="all">All Time</option>
            <option value="thisMonth">This Month</option>
            <option value="lastMonth">Last Month</option>
            <option value="last3Months">Last 3 Months</option>
            <option value="thisYear">This Year</option>
            <option value="custom">Custom Range</option>
          </select>
        </div>
        
        <!-- Unit Filter -->
        <div>
          <label for="unit" class="block text-sm font-medium text-gray-700 mb-1">Unit</label>
          <select
            id="unit"
            [(ngModel)]="unitFilter"
            (change)="applyFilters()"
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
          >
            <option value="all">All Units</option>
            <option value="101">Unit 101</option>
            <option value="102">Unit 102</option>
            <option value="103">Unit 103</option>
            <!-- More units would be populated dynamically -->
          </select>
        </div>
      </div>
      
      <!-- Custom date range -->
      <div *ngIf="dateRangeFilter === 'custom'" class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
        <div>
          <label for="startDate" class="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
          <input
            type="date"
            id="startDate"
            [(ngModel)]="startDate"
            (change)="applyFilters()"
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
          >
        </div>
        
        <div>
          <label for="endDate" class="block text-sm font-medium text-gray-700 mb-1">End Date</label>
          <input
            type="date"
            id="endDate"
            [(ngModel)]="endDate"
            (change)="applyFilters()"
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
          >
        </div>
      </div>
    </div>

    <!-- Simplified chart (in a real app, you might use Chart.js or similar) -->
    <div class="bg-white rounded-lg shadow-md p-6">
      <h2 class="text-lg font-semibold text-gray-800 mb-6">Monthly Payment Trends</h2>
      
      <div class="relative h-64">
        <!-- This is a simplified visualization - in a real app, you'd use a proper charting library -->
        <div class="absolute inset-0 flex items-end justify-between">
          <div *ngFor="let month of monthlyPayments" class="flex flex-col items-center w-full">
            <div class="relative w-full h-48 flex flex-col justify-end items-center">
              <!-- Paid amounts -->
              <div 
                class="w-4/5 bg-green-400 rounded-t"
                [style.height]="(month.paid / 2000) * 100 + '%'"
                [title]="'Paid: ' + formatCurrency(month.paid)"
              ></div>
              
              <!-- Due amounts stacked on top -->
              <div 
                *ngIf="month.due > 0"
                class="w-4/5 bg-yellow-400 absolute bottom-0"
                [style.height]="(month.due / 2000) * 100 + '%'"
                [style.transform]="'translateY(-' + (month.paid / 2000) * 100 + '%)'"
                [title]="'Due: ' + formatCurrency(month.due)"
              ></div>
            </div>
            <span class="text-xs text-gray-500 mt-1">{{ month.month }}</span>
          </div>
        </div>
        
        <!-- Y-axis labels -->
        <div class="absolute left-0 inset-y-0 flex flex-col justify-between text-xs text-gray-500">
          <span>$2000</span>
          <span>$1500</span>
          <span>$1000</span>
          <span>$500</span>
          <span>$0</span>
        </div>
      </div>
      
      <div class="flex items-center justify-center mt-4 text-sm">
        <div class="flex items-center mr-6">
          <div class="w-4 h-4 bg-green-400 mr-1"></div>
          <span>Paid</span>
        </div>
        <div class="flex items-center">
          <div class="w-4 h-4 bg-yellow-400 mr-1"></div>
          <span>Due</span>
        </div>
      </div>
    </div>

    <!-- Payment table -->
    <div class="bg-white rounded-lg shadow-md overflow-hidden">
      <div class="px-6 py-4 border-b border-gray-200">
        <h2 class="text-lg font-semibold text-gray-800">Payment Records</h2>
        <p class="text-sm text-gray-500">{{ filteredPayments.length }} payments found</p>
      </div>
      
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                ID
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Date
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Tenant
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Unit
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Type
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Amount
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Status
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Method
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <tr *ngFor="let payment of filteredPayments" class="hover:bg-gray-50">
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                {{ payment.id || payment.paymentId }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                {{ payment.date || payment.paymentDate | date:'MMM d, y' }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                {{ payment.tenantName || 'Unknown' }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                {{ payment.unitNumber || ('Unit ' + payment.unitId) }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                {{ payment.type || payment.paymentType || 'Payment' }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                {{ formatCurrency(payment.amount) }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span 
                  class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                  [ngClass]="getStatusClass(payment.status || '')">
                  {{ payment.status || 'Unknown' }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                {{ payment.paymentMethod || 'N/A' }}
              </td>
            </tr>
            
            <tr *ngIf="filteredPayments.length === 0">
              <td colspan="8" class="px-6 py-4 text-center text-gray-500">
                No payment records found matching your filters.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <!-- Simple pagination placeholder -->
      <div class="px-6 py-4 flex items-center justify-between border-t border-gray-200">
        <div class="text-sm text-gray-500">
          Showing <span class="font-medium">{{ filteredPayments.length > 0 ? 1 : 0 }}</span> to 
          <span class="font-medium">{{ filteredPayments.length }}</span> of 
          <span class="font-medium">{{ filteredPayments.length }}</span> results
        </div>
        
        <div class="flex-1 flex justify-end">
          <button 
            class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50"
            disabled
          >
            Previous
          </button>
          <button
            class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50"
            disabled
          >
            Next
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
